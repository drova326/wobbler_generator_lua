# Wobble Generator 

Скрипт для аппаратуры на базе EdgeTX/OpenTX (с разрешением экрана 128х64), упрощающий процесс получения логов для настройки PID (в связке с PIDToolBox), путем генерации управляющего воздействия вращения стика крена и тангажа с заданными частотой и амплитудой. При этом управление не перехватывается полностью - у пилота сохраняется возможность корректировать положение дрона в пространстве.  

![1](https://github.com/user-attachments/assets/75252e4b-cafe-4bf2-b09a-dcc4e88e4125) ![2](https://github.com/user-attachments/assets/e74318bd-c556-4a06-92a7-13a5ad02e5b8)  
![bandicam2024-12-2715-44-53-001-ezgif com-resize (1)](https://github.com/user-attachments/assets/aaa8e0c9-41d4-4db1-a28c-52e8097fb860)

После предварительной настройки скрипт начинает работать при соблюдении 2х условий: 
  - скрипт запущен через GUI
  - на аппаратуре актвирован соответсвующий триггер (тумблер, кнопка, логический свитч)
    
Удобнее всего повесить скрипт на тот же триггер, который начинает запись лога, а сам режим записи лога (автоматический вобблинг или свободный полет) выбирать непосредственно активируя/деактивируя скрипт через GUI. Такое поведение реализовано, чтобы можно было летать и настраиваться на одной и той же модели аппаратуры без перенастройки или задействования дополнительных триггеров.

Съем лога с помощью данного скрипта рекомендуется производить в режиме ANGEL. ([ВОТ ТУТ](https://www.youtube.com/watch?v=sqT4MACi3d8&t=101s) все достаточно подробно объяснено)

**!!! Если вы используете глобальные переменные (ГП) для ваших моделей, убедитесь, что номера их ячеек для хранения не пересекаются с ячейками переменных скрипта**
> gvRoll = 0 -- GV1 содержит текущую добавку к положению стика по roll  
> gvPitch = 1 -- GV2 содержит текущую добавку к положению стика по pitch  
> gvStatus = 2 -- GV3 - состояние скрипта (0 - скрипт не активен, 1 - скрипт ожидает события активации)    
> gvAmplitude = 3 -- GV4 - коэффициент отклонения стика  
> gvSpeed = 4 -- GV5 - скорость отклонения стика   

# Описание

Поскольку EdgeTX не позволяет повесить запуск скрипта с GUI на тумблер, но при этом интерфейс требуется для настройки параметров, скрипт разделен на 3 части, которые взаимодействуют между собой через ГП:

> 1) SCRIPTS/TOOLS/WobbleGeneratorGUI.lua

Предоставляет пилоту GUI, в котором можно задать амплитуду и скорость вращения стиком, а также непосредственно включить/выключить эмуляцию вращения стика.

> 2) SCRIPTS/TOOLS/wblr.lua  

Фоновый скрипт, который вешается на необходимое событие аппаратуры и в зависимости от настроек, заданных в GUI, воздействует на микшер каналов pitch/roll

> 3) SCRIPTS/TOOLS/rstgv.lua  

Отключает скрипт при перезагрузке аппаратуры до следующей ручной активации через GUI. Избавляет от необходимости деактивировать автовобблер по окончанию настроечной сессии. 

# Настройка

1) Копируем содержимое папки SCRIPTS в одноименную папку на карте памяти.
2) Во вкладке **SPECIAL FUNCTIONS**:
    - на запуск аппаратуры (событие ON) выставляем однократный запуск скрипта rstgv
    - на активацию триггера записи лога вешаем активацию скрипта wblr
    - на деактивацию триггера записи лога устанавливаем зануление глобальных переменных G1 и G2  
   
   ![gg7d3c17bab4 (1)](https://github.com/user-attachments/assets/feb3fd55-728b-4c1b-8e48-c99ff93dfc90)  
3) В настройках **MIXES** привязываем ГП к каналам:
    - переменную GV1 к каналу Roll
    - переменную GV2 к каналу Pitch  
    
    ![gg463c55f362](https://github.com/user-attachments/assets/42a6df46-7a83-4343-b49c-e3d849bd2058)
4) Открываем WobbleGeneratorGUI из вкладки **TOOLS**. Удержание кнопки ENTER позволяет задать требуемые параметры автовобблинга, а одиночный клик активирует/декактивирует генерацию.

